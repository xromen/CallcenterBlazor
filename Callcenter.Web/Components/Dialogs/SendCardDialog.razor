@using Callcenter.Web.Pages

<style>
    .send-panel.mud-panel-expanded {
        border: 1px solid #ffbd10;
    }
</style>

<MudDialog>
    <TitleContent>
        Переслать карточку
    </TitleContent>
    <DialogContent>
        <MudStack>
            <MudExpansionPanels>
                @foreach (var orgKv in _organisations)
                {
                    <MudExpansionPanel Text="@orgKv.Value"
                                       ExpandedChanged="(v) => ExpandedOrgChanged(v, orgKv.Key)"
                                       Class="send-panel">
                        <MudStack AlignItems="AlignItems.Center">
                            <MudStack AlignItems="AlignItems.Center"
                                      Style="width: fit-content">
                                <MudRadioGroup T="int?"
                                               ValueChanged="OperatorLevelChanged">
                                    <MudRadio T="int?"
                                              Color="Color.Info"
                                              Label="Оператор 1"
                                              Value="@(1)"/>
                                    <MudRadio T="int?"
                                              Color="Color.Info"
                                              Label="Оператор 2"
                                              Value="@(2)"/>
                                </MudRadioGroup>
                                <MudSelect @bind-Value="_selectedUserId"
                                           Variant="Variant.Outlined"
                                           Label="Пользователь"
                                           Margin="Margin.Dense"
                                           FullWidth="true">
                                    @if (_selectedOperatorLevel.HasValue)
                                    {
                                        <MudSelectItem T="int?" Value="@(0)">Все</MudSelectItem>
                                        @foreach (var user in _users.Where(c => c.OrgId == _selectedOrgId && c.GroupName.Contains(_selectedOperatorLevel.Value.ToString())))
                                        {
                                            <MudSelectItem T="int?" Value="@user.Id">@user.FullName</MudSelectItem>
                                        }
                                    }
                                </MudSelect>
                            </MudStack>
                        </MudStack>
                    </MudExpansionPanel>
                }
            </MudExpansionPanels>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Info"
                   Variant="Variant.Filled"
                   OnClick="Send"
                   Disabled="!_selectedOrgId.HasValue || !_selectedOperatorLevel.HasValue ||  !_selectedUserId.HasValue">
            Отправить
        </MudButton>
        <MudButton Color="Color.Transparent"
                   Variant="Variant.Filled"
                   OnClick="Cancel">
            Закрыть
        </MudButton>
    </DialogActions>
</MudDialog>